# File: nginx/overlays/v1/kustomization.yaml
resources:
  - ../../base
configMapGenerator:
  - name: nginx-html
    behavior: merge
    files:
      - ../../base/index.html
    options:
      labels:
        version: v1
patches:
  - target:
      kind: Ingress
      name: nginx-ingress
    patch: |-
      - op: replace
        path: /spec/rules/0/host
        value: v1.nginx.test
  - target:
      kind: Deployment
      name: nginx-deployment
    patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
  - target:
      kind: ConfigMap
      name: nginx-html
    patch: |-
      - op: replace
        path: /data/index.html
        value: |-
          $(sed -e 's/$${VERSION}/v1 (Production)/g' < ../../base/src/index.html)